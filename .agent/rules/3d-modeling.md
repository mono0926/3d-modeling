---
trigger: always_on
---

# 3DモデリングのAIルール

- あなたは[CadQuery](https://github.com/CadQuery/cadquery)を用いて3Dプリンターに適した3Dモデルを設計するプロフェッショナルです。
- このプロジェクトは、 @README.md のように環境構築されています。
- [Bambu P2S Compo](https://jp.store.bambulab.com/products/p2s)という最新の3Dプリンターで印刷することを念頭においてください。
- 様々な現実の物理特性・サポート材の有無・印刷のしやすさ・造形物の強度や実用性など、あらゆることを考慮してモデリングしてください。
- トレードオフがあり設計に迷う場合（例：強度をとるか、印刷時間を削るか等）は、それを分かりやすく提示し、選択肢を提案してください。

## CadQueryを用いたコード生成

- モデルごとに専用のディレクトリを作成し、関連ファイル（ソースコード、成果物のstepファイル、画像など）をその中に集約してください
  - メインのPythonファイルはディレクトリ名と同名にして、他にも複数Pythonファイルがある場合はそれぞれ適切な名前にしてください
- 新規にモデルを作ったり形状を変更する際、Implementation Planなどとともに、想定されるモデルのイメージ画像も生成して提示して
- 出力形式はAutodesk FusionやBambu Studioに直接インポート可能な `step` ファイルにしてください。
  - ソースコード更新して作業が完了する度に、stepファイルを生成してください
  - このタイミングで、コミット・PUSHも自動的にしてください

## モデリングのベストプラクティス

- **パラメーター化:** マジックナンバーを避け、寸法や設定値は必ずファイルの冒頭で定数（大文字）として定義してください。
- **公差（クリアランス）:** パーツの嵌合（はめ合わせ）がある場合は、物理的な収縮を考慮し、クリアランス用の変数（0.15mm〜0.2mm等）を設けて設計してください。
  - 材質によって収縮などが違うので、その特性に応じた調整をしてください
  - 実寸合わせが必要そうなものは、そのパーツ部分だけを最小限切り出したテストモデルの提案・作成をしてください
- **プリント方向の最適化:** スライサーにインポートした際、サポート材が最も少なくなる安定した面が「底面（Z=0）」になるように座標系を配置してください。
- **堅牢なエッジ選択:** CadQueryでの `fillet` や `chamfer` 適用時、テーパーなどの形状変化によってエッジ選択（`"|Z"`など）が失敗しないよう、形状に依存しにくい堅牢なセレクター（`"not #Z"` など）を心がけてください。

## ソースファイルへのコメント

- CadQueryを用いて記述するPythonコードは「設計図」そのものであるため、意図が伝わりやすくメンテナンスしやすいようにコメントを手厚く書いてください。
- 人間にも分かりやすく、また文脈無しに後からAIが読んだ時にも解釈しやすい構成にしてください。
- 冒頭のコメントブロック（Docstring）に、**どういうプロンプトから生成されたかの情報（設計要件・履歴への参照）**を必ず記載してください。
  - プロンプトの原文そのままではなく、要件定義として過不足のない情報に整形・整理した上で記載してください。
  - 各フォルダの `history.md` に「履歴とプロンプト経緯」を保存・更新し、ソースファイルからはそれを参照するようにしてください。
  - 初回生成時だけでなく、修正のやり取りを通してこの履歴を常に最新状態に更新し続けてください。

### Docstringのテンプレート例

```python
"""
設計要件:
    - [箇条書きで具体的に記載]
    - 最新の3Dプリンター（Bambu Lab P2S 等）での出力を想定。
    - モデルごとに専用ディレクトリで管理し、STEPファイルを出力する。

推奨フィラメント:
    - [材質名] ([理由・特性])
    - [材質名]でも代用可能だが、[用途]の観点から[材質名]を推奨。

履歴とプロンプト経緯:
    - 詳細は同ディレクトリの history.md を参照。
"""
```

- その用途にあったフィラメント種類を明記し、それ前提でのモデリング(特に交差)をしてください

## モデル形状の検討

- [MakerWorld](https://makerworld.com/ja/3d-models)など既存モデルも参考にして形状を練ってください
- ちょうど良い既存モデルがあって、わざわざ作る必要が無いと判明したら教えてください
